!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("rxjs")):"function"==typeof define&&define.amd?define(["react","rxjs"],e):"object"==typeof exports?exports.Reflow=e(require("react"),require("rxjs")):t.Reflow=e(t.React,t.Rx)}(this,function(t,e){return function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function o(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}o(r(1)),o(r(3)),o(r(4))},function(t,e,r){"use strict";var o=r(5),n=function(t){return function(){for(var e=[],r=0;arguments.length>r;r++)e[r]=arguments[r];return t.observe.apply(t,e)}},s=function(t){return function(e){return t.dispatch(e)}},i=function(){function t(t){var e=this;this.store=t,this.observe=function(){for(var t=[],r=0;arguments.length>r;r++)t[r]=arguments[r];if(e._destroyed||e.store.destroyed)return o.Observable.empty();var n=new o.BehaviorSubject(null);return e._subjects.push(n),e._subscriptions.push((s=e.store).observe.apply(s,t).subscribe(n)),n.distinctUntilChanged().debounceTime(1,o.Scheduler.queue);var s},this.dispatch=function(t){if("function"==typeof t){var r=!1,o=t(e.tools);return function(){r||"function"!=typeof o||o(),r=!0}}var n=!1;return Promise.resolve(t).then(function(t){n||Object.keys(t).forEach(function(r){e.store.isPlainState(r)&&e.store.update(r,t[r])})}),function(){return n=!0}},this._destroyed=!1,this._subjects=[],this._subscriptions=[]}return Object.defineProperty(t.prototype,"tools",{get:function(){var t=this,e={observe:n(this),dispatch:s(this)},r=this.store.tools;return Object.keys(r).forEach(function(o){e[o]=r[o](t)}),e},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){for(var t=0,e=this._subjects;e.length>t;t++){var r=e[t];r.complete(),r.unsubscribe()}for(var o=0,n=this._subscriptions;n.length>o;o++){var s=n[o];s.unsubscribe()}this._subjects=null,this._subscriptions=null,this._destroyed=!0},t}();e.StorePermit=i;var u=function(){function t(t,e){var r=this;this.config=t,this.parentStore=e,this.isPlainState=function(t){return"function"!=typeof r.config.state[t]},this.update=function(t,e){if(r._observables.has(t)){var n=r._observables.get(t);n instanceof o.Subject&&n.next(e)}else r.parentStore&&r.parentStore.update(t,e)},this.getObservable=function(t){if(void 0!==r.config.state[t]){if(!r._observables.has(t)){var e=r.isPlainState(t)?new o.BehaviorSubject(r.config.state[t]):r.config.state[t](r.observe);r._observables.set(t,e)}return r._observables.get(t)}return r.parentStore?r.parentStore.getObservable(t):void 0},this.observe=function(){for(var t=[],e=0;arguments.length>e;e++)t[e]=arguments[e];if(1===t.length)return r.getObservable(t[0]).map(function(e){var r={};return r[t[0]]=e,r});if(t.length>1)return o.Observable.combineLatest.apply(o.Observable,t.map(function(t){return r.getObservable(t)}).concat([function(){for(var e=[],r=0;arguments.length>r;r++)e[r]=arguments[r];return e.reduce(function(e,r,o){return e[t[o]]=r,e},{})}]));throw Error("names length is 0")},this._observables=new Map,this._destroyed=!1,"function"==typeof t.startup&&(this._startupPermit=this.access(),this._startupTeardown=this._startupPermit.dispatch(this.config.startup))}return Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tools",{get:function(){var t=this.config&&this.config.tools?this.config.tools:{};return this.parentStore?Object.assign({},this.parentStore.tools,t):t||{}},enumerable:!0,configurable:!0}),t.prototype.access=function(){return new i(this)},t.prototype.destroy=function(){"function"==typeof this._startupTeardown&&this._startupTeardown(),this._startupPermit instanceof i&&this._startupPermit.destroy(),this._startupTeardown=null,this._startupPermit=null,this._observables.forEach(function(t){t instanceof o.Subject&&(t.complete(),t.unsubscribe())}),this._observables.clear(),this._destroyed=!0},t}();e.Store=u},function(e,r){e.exports=t},function(t,e,r){"use strict";function o(t){u.forEach(function(e){if(void 0!==t.state[e])throw Error('Do not include "'+e+'" to "state"')});var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.observe=function(){for(var e=[],r=0;arguments.length>r;r++)e[r]=arguments[r];return(o=t.permit).observe.apply(o,e);var o},t.dispatch=function(e){return t.permit.dispatch(e)},t}return n(r,e),r.prototype.getChildContext=function(){return{reflowStore:this.store}},r.prototype.render=function(){return this.props.children},r.prototype.propsToUpdate=function(t,e){for(var r={},o=!1,n=0,s=e;s.length>n;n++){var i=s[n],u=i[0],p=i[1];this.store.isPlainState(u)&&t[u]!==e[u]&&(r[u]=p,o=!0)}return o?r:null},r.prototype.componentWillMount=function(){this.store=new i.Store(t,this.props.parentStore||this.context.reflowStore),this.permit=this.store.access();var e=this.propsToUpdate({},this.props);e&&this.permit.dispatch(e)},r.prototype.componentWillReceiveProps=function(t){var e=this.propsToUpdate(this.props,t);e&&this.permit.dispatch(e)},r.prototype.componentWillUnmount=function(){this.permit.destroy(),this.store.destroy(),this.permit=null,this.store=null},r}(s.Component);return e.displayName="Context({"+Object.keys(t.state).join(",")+"})",e.childContextTypes={reflowStore:s.PropTypes.object},e.contextTypes={reflowStore:s.PropTypes.object},e}var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=r(2),i=r(1),u=["children","parentStore"];e.createContext=o},function(t,e,r){"use strict";function o(t,e){return function(r){var o=function(r){function o(){var t=null!==r&&r.apply(this,arguments)||this;return t.state={drops:{}},t}return n(o,r),o.prototype.render=function(){return s.cloneElement(this.props.children,this.state.drops)},o.prototype.updateDrops=function(t){this.setState({drops:Object.assign({},t,this.dropState,this.dropHandlers)})},o.prototype.componentWillMount=function(){var r=this;if(this.permit=this.context.reflowStore.access(),this.dropHandlers="function"==typeof e?e(this.permit.tools):{},"function"!=typeof t)throw Error("...");this.subscription=t(this.permit.observe).subscribe(function(t){r.dropState=t,r.updateDrops(r.props)})},o.prototype.componentWillReceiveProps=function(t){this.updateDrops(t)},o.prototype.componentWillUnmount=function(){this.subscription&&this.subscription.unsubscribe(),this.permit.destroy(),this.subscription=null,this.permit=null,this.dropHandlers=null,this.dropState=null},o}(s.Component);return o.displayName="Provider("+r.displayName+")",o.contextTypes={reflowStore:s.PropTypes.object},function(t){return s.createElement(o,t,s.createElement(r))}}}var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=r(2);e.provide=o},function(t,r){t.exports=e}])});
//# sourceMappingURL=reflow.js.map