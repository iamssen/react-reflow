{"version":3,"file":"main.js","sources":["webpack:///src/main.jsx","webpack:///","webpack:///./~/lodash.isplainobject/index.js","webpack:///./~/react-reflow/lib/index.js"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {createContext} from 'react-reflow';\n\nconst rand = () => Math.floor(Math.random() * 1000);\n\n// ---------------------------------------------\n// actions\n// ---------------------------------------------\nconst UPDATE_X = 'UPDATE_X';\nconst UPDATE_Y = 'UPDATE_Y';\n\nconst plainAction = () => {\n  return {\n    type: UPDATE_X,\n    x: 'Plain Action - ' + rand()\n  };\n}\n\nconst promiseAction = () => {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      resolve({\n        type: UPDATE_X,\n        x: 'Promise Action - ' + rand(),\n      });\n    }, 1000);\n  });\n}\n\nconst thunkAction = () => ({dispatch}) => {\n  setTimeout(() => {\n    dispatch({\n      type: UPDATE_X,\n      x: 'Thunk Action - ' + rand(),\n    });\n  }, 1000);\n}\n\nconst toParentAction = () => ({enterParent}) => {\n  enterParent(({dispatch}) => {\n    dispatch({\n      type: UPDATE_X,\n      x: 'To Parent from Child - ' + rand(),\n    });\n  });\n}\n\n// ---------------------------------------------\n// reducers\n// ---------------------------------------------\nconst x = (state = 'none', action) => {\n  if (action.type === UPDATE_X) return action.x;\n  return state;\n}\n\nconst y = (state = 'none', action) => {\n  if (action.type === UPDATE_Y) return action.y;\n  return state;\n}\n\n// ---------------------------------------------\n// backgrounds\n// ---------------------------------------------\nconst backgroundService = ({dispatch}) => {\n  const intervalId = setInterval(() => {\n    console.log('Background Service - ' + Date.now());\n  }, 500);\n  return () => {\n    clearInterval(intervalId);\n  }\n}\n\n// ---------------------------------------------\n// contexts\n// ---------------------------------------------\nconst TopContext = createContext()\n  .reducers({x})\n  // .backgrounds(backgroundService)\n  .toComponent();\n\nconst GroupContext = createContext()\n  .reducers({y})\n  .toComponent();\n\n// ---------------------------------------------\n// components\n// ---------------------------------------------\nclass A extends React.Component {\n  static contextTypes = {\n    x: React.PropTypes.string,\n    dispatch: React.PropTypes.func,\n  };\n  \n  render() {\n    return (\n      <div style={{border: '1px solid black', padding: '15px'}}>\n        <h1>{this.context.x}</h1>\n        <button onClick={this.dispatchPlain}>Dispatch Plain Action</button>\n        <button onClick={this.dispatchPromise}>Dispatch Promise Action</button>\n        <button onClick={this.dispatchThunk}>Dispatch Thunk Action</button>\n        {this.props.children}\n      </div>\n    );\n  }\n  \n  dispatchPlain = () => {\n    this.context.dispatch(plainAction());\n  }\n  \n  dispatchPromise = () => {\n    this.context.dispatch(promiseAction());\n  }\n  \n  dispatchThunk = () => {\n    this.context.dispatch(thunkAction());\n  }\n}\n\nclass B extends React.Component {\n  static contextTypes = {\n    x: React.PropTypes.string,\n    y: React.PropTypes.string,\n    dispatch: React.PropTypes.func,\n    enterParent: React.PropTypes.func,\n  }\n  \n  render() {\n    return (\n      <div style={{border: '1px solid black', padding: '15px', marginTop: '10px'}}>\n        <h1>{this.context.x} : {this.context.y}</h1>\n        <button onClick={this.toParentWithEnterParent}>To Parent With enterParent()</button>\n        <button onClick={this.toParentAction}>To Parent Action</button>\n        <button onClick={this.dispatch}>Dispatch Internal</button>\n      </div>\n    );\n  }\n  \n  dispatch = () => {\n    this.context.dispatch({\n      type: UPDATE_Y,\n      y: 'Internal Value - ' + rand(),\n    });\n  }\n  \n  toParentWithEnterParent = () => {\n    this.context.enterParent(({dispatch}) => {\n      dispatch({\n        type: UPDATE_X,\n        x: 'From Child - ' + rand(),\n      });\n    });\n  }\n  \n  toParentAction = () => {\n    this.context.dispatch(toParentAction());\n  }\n}\n\n// ---------------------------------------------\n// render\n// ---------------------------------------------\nReactDOM.render((\n  <TopContext initialStates={{x: 'Initial Value...'}}>\n    <A>\n      <GroupContext>\n        <B/>\n      </GroupContext>\n      <GroupContext>\n        <B/>\n      </GroupContext>\n      <GroupContext>\n        <B/>\n      </GroupContext>\n      <GroupContext>\n        <div style={{border: '1px solid black', padding: '10px', marginTop: '10px'}}>\n          <B/>\n          <B/>\n        </div>\n      </GroupContext>\n    </A>\n  </TopContext>\n), document.querySelector('#app'));\n\n\n/** WEBPACK FOOTER **\n ** src/main.jsx\n **/","undefined\n\n\n/** WEBPACK FOOTER **\n ** \n **/","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) ||\n      objectToString.call(value) != objectTag || isHostObject(value)) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nmodule.exports = isPlainObject;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/lodash.isplainobject/index.js\n ** module id = 349\n ** module chunks = 2\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.createContext = createContext;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _lodash = require('lodash.isplainobject');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Context = function () {\n  function Context() {\n    _classCallCheck(this, Context);\n  }\n\n  _createClass(Context, [{\n    key: 'reducers',\n    value: function reducers(_reducers) {\n      this._reducers = Object.assign(this._reducers || {}, _reducers);\n      return this;\n    }\n  }, {\n    key: 'backgrounds',\n    value: function backgrounds() {\n      var _this = this;\n\n      if (!this.bg) this.bg = new Set();\n\n      for (var _len = arguments.length, _backgrounds = Array(_len), _key = 0; _key < _len; _key++) {\n        _backgrounds[_key] = arguments[_key];\n      }\n\n      _backgrounds.filter(function (bg) {\n        return !_this.bg.has(bg);\n      }).forEach(function (bg) {\n        return _this.bg.add(bg);\n      });\n      return this;\n    }\n  }, {\n    key: 'toComponent',\n    value: function toComponent() {\n      var contextTypes = {\n        __REFLOW_ENTER_PARENT__: _react2.default.PropTypes.func\n      };\n\n      var childContextTypes = {\n        __REFLOW_ENTER_PARENT__: _react2.default.PropTypes.func,\n        enterParent: _react2.default.PropTypes.func,\n        dispatch: _react2.default.PropTypes.func\n      };\n\n      var reducers = this._reducers;\n      var reducerNames = reducers ? Object.keys(reducers) : [];\n      reducerNames.forEach(function (name) {\n        return childContextTypes[name] = _react2.default.PropTypes.any;\n      });\n\n      var backgrounds = this.bg ? Array.from(this.bg) : [];\n\n      var Component = function (_React$Component) {\n        _inherits(Component, _React$Component);\n\n        function Component() {\n          var _ref;\n\n          var _temp, _this2, _ret;\n\n          _classCallCheck(this, Component);\n\n          for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n            args[_key2] = arguments[_key2];\n          }\n\n          return _ret = (_temp = (_this2 = _possibleConstructorReturn(this, (_ref = Component.__proto__ || Object.getPrototypeOf(Component)).call.apply(_ref, [this].concat(args))), _this2), _this2.state = {}, _this2.dispatch = function (action) {\n            Promise.resolve(action).then(function (action) {\n              if ((0, _lodash2.default)(action)) {\n                (function () {\n                  var state = {};\n                  var changed = false;\n\n                  reducerNames.forEach(function (name) {\n                    var current = _this2.store[name];\n                    var next = reducers[name](current, action);\n                    if (current !== next) {\n                      _this2.store[name] = next;\n                      state[name] = next;\n                      changed = true;\n                    }\n                  });\n\n                  if (changed) _this2.setState(state);\n                })();\n              } else if (typeof action === 'function') {\n                _this2.dispatch(action(_this2.getChildContext()));\n              }\n            });\n          }, _this2.enterParent = function (fn) {\n            fn(_this2.getChildContext());\n          }, _temp), _possibleConstructorReturn(_this2, _ret);\n        } // from parent\n        // to children\n\n        _createClass(Component, [{\n          key: 'getChildContext',\n          value: function getChildContext() {\n            var _this3 = this;\n\n            var context = {\n              __REFLOW_ENTER_PARENT__: this.enterParent,\n              enterParent: this.context.__REFLOW_ENTER_PARENT__,\n              dispatch: this.dispatch\n            };\n\n            reducerNames.forEach(function (r) {\n              return context[r] = _this3.state[r];\n            });\n\n            return context;\n          }\n        }, {\n          key: 'render',\n          value: function render() {\n            return this.props.children;\n          }\n        }, {\n          key: 'componentWillMount',\n          value: function componentWillMount() {\n            if (this.props.initialStates) {\n              this.store = this.props.initialStates;\n              this.setState(this.props.initialStates);\n            } else {\n              this.store = {};\n            }\n            this.dispatch({ type: '__REFLOW_INIT__' });\n          }\n        }, {\n          key: 'componentDidMount',\n          value: function componentDidMount() {\n            var context = this.getChildContext();\n            this.unsubscribes = backgrounds.map(function (bg) {\n              return bg(context);\n            });\n          }\n        }, {\n          key: 'componentWillUnmount',\n          value: function componentWillUnmount() {\n            this.unsubscribes.forEach(function (unsubscribe) {\n              return unsubscribe();\n            });\n          }\n        }]);\n\n        return Component;\n      }(_react2.default.Component);\n\n      Component.contextTypes = contextTypes;\n      Component.childContextTypes = childContextTypes;\n      Component.propTypes = {\n        initialStates: _react2.default.PropTypes.object\n      };\n\n\n      return Component;\n    }\n  }]);\n\n  return Context;\n}();\n\nfunction createContext() {\n  return new Context();\n}\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/react-reflow/lib/index.js\n ** module id = 350\n ** module chunks = 2\n **/"],"mappings":";;;;;;;;;AAAA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;;;;;;;AACA;AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ADFA;AAIA;AACA;AACA;ACCA;AACA;AACA;AACA;AACA;ADFA;AAIA;AACA;AACA;AACA;AACA;ACAA;AAAA;AACA;AAAA;AACA;AACA;AACA;ADFA;AAIA;AACA;AAPA;AACA;AAQA;ACAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;ADFA;AAIA;AACA;AAPA;AACA;AAQA;AACA;AACA;AACA;ACAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAFA;AACA;AAIA;AACA;AAGA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AAkBA;AACA;AACA;AAGA;AACA;AAGA;AACA;;;;;AAtBA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AALA;AAQA;;;;AAhBA;AACA;AADA;AAEA;AACA;AAFA;AACA;AA6BA;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;ADFA;AAIA;ACGA;AAAA;AACA;AAAA;AACA;AACA;ADFA;AAIA;AACA;ACGA;AACA;;;;;AA7BA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAOA;;;;AAjBA;AACA;AAuCA;AACA;AACA;AACA;AACA;AA5CA;AAEA;AACA;AACA;AACA;AAJA;AA0CA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AADA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AADA;AAVA;AADA;;;;;;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;","sourceRoot":""}